<!DOCTYPE html><html><head>
      <title>v3-Addons</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\Muschuang123\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.19\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#666866}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#971d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0046b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#0046b3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0046b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#0046b3}.language-makefile .token.symbol{color:#0046b3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0046b3}.language-bash .token.keyword{color:#0046b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

  pre {
    counter-reset: line;
    position: relative;
  }
  pre code .line {
    white-space: pre-wrap;
    padding-left: 2.5em;
    counter-increment: line;
    position: relative;
    word-wrap: break-word;
    box-decoration-break: clone;
    -webkit-box-decoration-break: clone;
  }
  pre code .line:before {
    padding-top: 0.2em;
    content: counter(line);
    position: absolute;
    left: -3em;
    width: 4.2em;
    text-align: right;
    color: #000;
    /* border-right: 1px solid #ddd; */
    /* padding-right: 0.5em; */
  }

      </style>
      <!-- The content below will be included at the end of the <head> element. -->
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    const codeBlocks = document.querySelectorAll('pre code');
    codeBlocks.forEach(block => {
      const content = block.innerHTML;
      const lines = content.split('\n');
      let newContent = '';
      lines.forEach(line => {
        newContent += `<span class="line">${line}</span>\n`;
      });
      block.innerHTML = newContent;
    });
  });
</script>
</head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h2 id="动态开点线段树">动态开点线段树 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span>
<span class="token keyword keyword-using">using</span> ld <span class="token operator">=</span> <span class="token keyword keyword-long">long</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> i64 <span class="token operator">=</span> <span class="token keyword keyword-long">long</span> <span class="token keyword keyword-long">long</span><span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> maxn <span class="token operator">=</span> <span class="token number">1e5</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword keyword-int">int</span> mod <span class="token operator">=</span> <span class="token number">1e9</span> <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">;</span>
<span class="token keyword keyword-int">int</span> rt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// 使用前先 init()</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">DST</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> tot <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-struct">struct</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-int">int</span> ls<span class="token punctuation">,</span> rs<span class="token punctuation">,</span> v<span class="token punctuation">,</span> laz<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> t<span class="token punctuation">[</span>maxn <span class="token operator">*</span> <span class="token number">66</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Q(查询次数) * 2logV(值域大小)</span>
    <span class="token comment">// 极端情况下单次修改可能创建 接近 2logV 个节点</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">me</span> <span class="token expression">t<span class="token punctuation">[</span>p<span class="token punctuation">]</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">lc</span> <span class="token expression">t<span class="token punctuation">[</span>t<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>ls<span class="token punctuation">]</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">rc</span> <span class="token expression">t<span class="token punctuation">[</span>t<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>rs<span class="token punctuation">]</span></span></span>

    <span class="token keyword keyword-void">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> tot<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tot <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">pushup</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        me<span class="token punctuation">.</span>v <span class="token operator">=</span> <span class="token punctuation">(</span>lc<span class="token punctuation">.</span>v <span class="token operator">+</span> rc<span class="token punctuation">.</span>v<span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span> <span class="token comment">// pushup</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">pushdown</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> p<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> L<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> R<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>me<span class="token punctuation">.</span>laz<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-int">int</span> M <span class="token operator">=</span> L <span class="token operator">+</span> R <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>me<span class="token punctuation">.</span>ls<span class="token punctuation">)</span> me<span class="token punctuation">.</span>ls <span class="token operator">=</span> <span class="token operator">++</span>tot<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>me<span class="token punctuation">.</span>rs<span class="token punctuation">)</span> me<span class="token punctuation">.</span>rs <span class="token operator">=</span> <span class="token operator">++</span>tot<span class="token punctuation">;</span>
        lc<span class="token punctuation">.</span>v <span class="token operator">=</span> <span class="token punctuation">(</span>lc<span class="token punctuation">.</span>v <span class="token operator">+</span> <span class="token number">1LL</span> <span class="token operator">*</span> me<span class="token punctuation">.</span>laz <span class="token operator">*</span> <span class="token punctuation">(</span>M <span class="token operator">-</span> L <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
        rc<span class="token punctuation">.</span>v <span class="token operator">=</span> <span class="token punctuation">(</span>rc<span class="token punctuation">.</span>v <span class="token operator">+</span> <span class="token number">1LL</span> <span class="token operator">*</span> me<span class="token punctuation">.</span>laz <span class="token operator">*</span> <span class="token punctuation">(</span>R <span class="token operator">-</span> M<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
        lc<span class="token punctuation">.</span>laz <span class="token operator">=</span> <span class="token punctuation">(</span>lc<span class="token punctuation">.</span>laz <span class="token operator">+</span> me<span class="token punctuation">.</span>laz<span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
        rc<span class="token punctuation">.</span>laz <span class="token operator">=</span> <span class="token punctuation">(</span>rc<span class="token punctuation">.</span>laz <span class="token operator">+</span> me<span class="token punctuation">.</span>laz<span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
        me<span class="token punctuation">.</span>laz <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// int rt = 1;</span>
    <span class="token comment">// add(rt, 1, n, l, r, d);</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> <span class="token operator">&amp;</span>p<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> L<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> R<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> l<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> r<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p<span class="token punctuation">)</span> p <span class="token operator">=</span> <span class="token operator">++</span>tot<span class="token punctuation">;</span> <span class="token comment">// 开点</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>r <span class="token operator">&lt;</span> L <span class="token operator">||</span> R <span class="token operator">&lt;</span> l<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;=</span> L <span class="token operator">&amp;&amp;</span> R <span class="token operator">&lt;=</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            me<span class="token punctuation">.</span>v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1LL</span> <span class="token operator">*</span> me<span class="token punctuation">.</span>v <span class="token operator">+</span> <span class="token number">1LL</span> <span class="token operator">*</span> <span class="token punctuation">(</span>R <span class="token operator">-</span> L <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> d<span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
            me<span class="token punctuation">.</span>laz <span class="token operator">=</span> <span class="token punctuation">(</span>me<span class="token punctuation">.</span>laz <span class="token operator">+</span> d<span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">pushdown</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> L<span class="token punctuation">,</span> R<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-int">int</span> M <span class="token operator">=</span> L <span class="token operator">+</span> R <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span>me<span class="token punctuation">.</span>ls<span class="token punctuation">,</span> L<span class="token punctuation">,</span> M<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span>me<span class="token punctuation">.</span>rs<span class="token punctuation">,</span> M <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> R<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">pushup</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> p<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> L<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> R<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> l<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;=</span> L <span class="token operator">&amp;&amp;</span> R <span class="token operator">&lt;=</span> r<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> t<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">;</span>
        <span class="token function">pushdown</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> L<span class="token punctuation">,</span> R<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-int">int</span> res <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-int">int</span> M <span class="token operator">=</span> L <span class="token operator">+</span> R <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;=</span> M<span class="token punctuation">)</span> res <span class="token operator">=</span> <span class="token punctuation">(</span>res <span class="token operator">+</span> <span class="token function">query</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>ls<span class="token punctuation">,</span> L<span class="token punctuation">,</span> M<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>r <span class="token operator">&gt;</span> M<span class="token punctuation">)</span> res <span class="token operator">=</span> <span class="token punctuation">(</span>res <span class="token operator">+</span> <span class="token function">query</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span>rs<span class="token punctuation">,</span> M <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> R<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> mod<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">me</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">lc</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">rc</span></span>

<span class="token punctuation">}</span> T<span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ios<span class="token double-colon punctuation">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    T<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> m<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">1000000000</span><span class="token punctuation">;</span>
    cin <span class="token operator">&gt;&gt;</span> m <span class="token operator">&gt;&gt;</span> mod<span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>m<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-int">int</span> op<span class="token punctuation">;</span>
        cin <span class="token operator">&gt;&gt;</span> op<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>op <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-int">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>
            cin <span class="token operator">&gt;&gt;</span> x <span class="token operator">&gt;&gt;</span> y <span class="token operator">&gt;&gt;</span> z<span class="token punctuation">;</span>
            T<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rt<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-int">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
            cin <span class="token operator">&gt;&gt;</span> x <span class="token operator">&gt;&gt;</span> y<span class="token punctuation">;</span>
            cout <span class="token operator">&lt;&lt;</span> T<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>rt<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="二维全集">二维全集 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span>
<span class="token keyword keyword-using">using</span> ld <span class="token operator">=</span> <span class="token keyword keyword-long">long</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> i64 <span class="token operator">=</span> <span class="token keyword keyword-long">long</span> <span class="token keyword keyword-long">long</span><span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// 有浮点数但是大部分都是 i64 时，可以选择用 pair&lt;ld, ld&gt; 替换必需内容</span>
<span class="token comment">// 然后删去强制浮点数的函数，改用手写 pair&lt;ld, ld&gt; 替代。</span>
<span class="token keyword keyword-using">using</span> T <span class="token operator">=</span> ld<span class="token punctuation">;</span> <span class="token comment">// 全局数据类型</span>

<span class="token keyword keyword-const">const</span> T eps <span class="token operator">=</span> <span class="token number">1e-12</span><span class="token punctuation">;</span> <span class="token comment">// 注意一旦使用 T = i64，eps 就是 0LL ！！！</span>
<span class="token keyword keyword-const">const</span> T INF <span class="token operator">=</span> <span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> T PI <span class="token operator">=</span> <span class="token function">acosl</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注意一旦使用 T = i64，PI 就是 3LL ！！！</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">setp</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> cout <span class="token operator">&lt;&lt;</span> fixed <span class="token operator">&lt;&lt;</span> <span class="token function">setprecision</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span></span>
<span class="token keyword keyword-int">int</span> <span class="token function">sgn</span><span class="token punctuation">(</span>T x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">&lt;</span> <span class="token operator">-</span>eps <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> x <span class="token operator">&gt;</span> eps<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">// 点与向量</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Pt</span> <span class="token punctuation">{</span>
    T x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>y <span class="token operator">-</span> a<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">==</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> y <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> eps<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">x</span> <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>x <span class="token operator">-</span> eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">&lt;</span> a <span class="token operator">||</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">==</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">+</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> a<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">-</span> a<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> T k<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>k <span class="token operator">*</span> x<span class="token punctuation">,</span> k <span class="token operator">*</span> y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> T k<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">/</span> k<span class="token punctuation">,</span> y <span class="token operator">/</span> k<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    T <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">*</span> a<span class="token punctuation">.</span>x <span class="token operator">+</span> y <span class="token operator">*</span> a<span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 点积</span>
    T <span class="token keyword keyword-operator">operator</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">*</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> y <span class="token operator">*</span> a<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 叉积，注意优先级</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">toleft</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span> <span class="token operator">^</span> a<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>t <span class="token operator">&gt;</span> eps<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;</span> <span class="token operator">-</span>eps<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token comment">// to-left 测试</span>
    T <span class="token function">len2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>               <span class="token comment">// 向量长度的平方</span>
    T <span class="token function">dis2</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 两点距离的平方</span>
    <span class="token comment">// 0:原点 | 1:x轴正 | 2:第一象限</span>
    <span class="token comment">// 3:y轴正 | 4:第二象限 | 5:x轴负</span>
    <span class="token comment">// 6:第三象限 | 7:y轴负 | 8:第四象限</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">quad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> y <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token number">3</span> <span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> y <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token number">8</span> <span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// i64 + pair&lt;ld, ld&gt;</span>
    <span class="token comment">// ld dis(const pair&lt;ld, ld&gt; &amp;a) { return sqrtl((a.first - x) * (a.first - x) + (a.second - y) * (a.second - y)); }</span>
    <span class="token comment">// 必须用浮点数</span>
    T <span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token function">sqrtl</span><span class="token punctuation">(</span><span class="token function">len2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>                                                              <span class="token comment">// 向量长度</span>
    T <span class="token function">dis</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token function">sqrtl</span><span class="token punctuation">(</span><span class="token function">dis2</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>                                                  <span class="token comment">// 两点距离</span>
    T <span class="token function">ang</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token function">acosl</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.0L</span><span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token number">1.0L</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span> <span class="token operator">*</span> a<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> a<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 向量夹角</span>
    Pt <span class="token function">rot</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> T rad<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">*</span> <span class="token function">cosl</span><span class="token punctuation">(</span>rad<span class="token punctuation">)</span> <span class="token operator">-</span> y <span class="token operator">*</span> <span class="token function">sinl</span><span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">,</span> x <span class="token operator">*</span> <span class="token function">sinl</span><span class="token punctuation">(</span>rad<span class="token punctuation">)</span> <span class="token operator">+</span> y <span class="token operator">*</span> <span class="token function">cosl</span><span class="token punctuation">(</span>rad<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 逆时针旋转（给定角度）</span>
    Pt <span class="token function">rot</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> T cosr<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> T sinr<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">*</span> cosr <span class="token operator">-</span> y <span class="token operator">*</span> sinr<span class="token punctuation">,</span> x <span class="token operator">*</span> sinr <span class="token operator">+</span> y <span class="token operator">*</span> cosr<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>      <span class="token comment">// 逆时针旋转（给定角度的正弦与余弦）</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// pair&lt;ld, ld&gt; 叉积</span>
ld <span class="token keyword keyword-operator">operator</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> pair<span class="token operator">&lt;</span>ld<span class="token punctuation">,</span> ld<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> pair<span class="token operator">&lt;</span>ld<span class="token punctuation">,</span> ld<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> a<span class="token punctuation">.</span>first <span class="token operator">*</span> b<span class="token punctuation">.</span>second <span class="token operator">-</span> a<span class="token punctuation">.</span>second <span class="token operator">*</span> b<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 极角排序</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Argcmp</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>b<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> qa <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">quad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> qb <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">quad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>qa <span class="token operator">!=</span> qb<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> qa <span class="token operator">&lt;</span> qb<span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> t <span class="token operator">=</span> a <span class="token operator">^</span> b<span class="token punctuation">;</span>
        <span class="token comment">// 不同长度的向量需要分开</span>
        <span class="token comment">// if (abs(t) &lt;= eps) return a * a &lt; b * b - eps;</span>
        <span class="token keyword keyword-return">return</span> t <span class="token operator">&gt;</span> eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 直线</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Lt</span> <span class="token punctuation">{</span>
    Pt p<span class="token punctuation">,</span> v<span class="token punctuation">;</span> <span class="token comment">// p 为直线上一点，v 为方向向量</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Lt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> v<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>p <span class="token operator">-</span> a<span class="token punctuation">.</span>p<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">toleft</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> v<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>a <span class="token operator">-</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// to-left 测试</span>
    <span class="token comment">// 半平面交算法定义的排序</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Lt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>v <span class="token operator">^</span> a<span class="token punctuation">.</span>v<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">&amp;&amp;</span> v <span class="token operator">*</span> a<span class="token punctuation">.</span>v <span class="token operator">&gt;=</span> <span class="token operator">-</span>eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token function">toleft</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>p<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">Argcmp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> a<span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// i64 + pair&lt;ld, ld&gt;</span>
    <span class="token comment">// pair&lt;ld, ld&gt; inter(const Lt &amp;a) const {</span>
    <span class="token comment">//     ld k = 1.0L * (a.v ^ (p - a.p)) / (v ^ a.v);</span>
    <span class="token comment">//     return {p.x + v.x * k, p.y + v.y * k};</span>
    <span class="token comment">// }</span>
    <span class="token comment">// 必须用浮点数</span>
    Pt <span class="token function">inter</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Lt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> p <span class="token operator">+</span> v <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>v <span class="token operator">^</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> a<span class="token punctuation">.</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>v <span class="token operator">^</span> a<span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 直线交点</span>
    T <span class="token function">dis</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token function">abs</span><span class="token punctuation">(</span>v <span class="token operator">^</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> v<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>                 <span class="token comment">// 点到直线距离</span>
    Pt <span class="token function">pedal</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> p <span class="token operator">+</span> v <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">*</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>v <span class="token operator">*</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>       <span class="token comment">// 点在直线上的投影</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 线段</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">St</span> <span class="token punctuation">{</span>
    Pt a<span class="token punctuation">,</span> b<span class="token punctuation">;</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> St <span class="token operator">&amp;</span>s<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>a<span class="token punctuation">,</span> s<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">// 判定性函数建议在整数域使用</span>
    <span class="token comment">// 判断点是否在线段上</span>
    <span class="token comment">// -1 点在线段端点 | 0 点不在线段上 | 1 点严格在线段上</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">is_on</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>p<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> a <span class="token operator">||</span> p <span class="token operator">==</span> b<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>p <span class="token operator">-</span> b<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token operator">-</span>eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 判断线段直线是否相交</span>
    <span class="token comment">// -1 直线经过线段端点 | 0 线段和直线不相交 | 1 线段和直线严格相交</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">is_inter</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Lt <span class="token operator">&amp;</span>l<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> l<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> l<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">!=</span> l<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 判断两线段是否相交</span>
    <span class="token comment">// -1 在某一线段端点处相交 | 0 两线段不相交 | 1 两线段严格相交</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">is_inter</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> St <span class="token operator">&amp;</span>s<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">is_on</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">is_on</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token operator">||</span> s<span class="token punctuation">.</span><span class="token function">is_on</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">||</span> s<span class="token punctuation">.</span><span class="token function">is_on</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> Lt l<span class="token punctuation">{</span>a<span class="token punctuation">,</span> b <span class="token operator">-</span> a<span class="token punctuation">}</span><span class="token punctuation">,</span> ls<span class="token punctuation">{</span>s<span class="token punctuation">.</span>a<span class="token punctuation">,</span> s<span class="token punctuation">.</span>b <span class="token operator">-</span> s<span class="token punctuation">.</span>a<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> l<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token operator">*</span> l<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> ls<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">*</span> ls<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 计算线段上的网格点数量（包括端点）</span>
    <span class="token comment">// 要求端点都在网格点上（必须用整数）</span>
    i64 <span class="token function">calc_pts_on_segment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        i64 dx <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>x <span class="token operator">-</span> b<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> dy <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>y <span class="token operator">-</span> b<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>dx <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> dx <span class="token operator">=</span> <span class="token operator">-</span>dx<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>dy <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> dy <span class="token operator">=</span> <span class="token operator">-</span>dy<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">gcd</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 点到线段距离（必须用浮点数）</span>
    T <span class="token function">dis</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>p<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token operator">-</span>eps <span class="token operator">||</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> b<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token operator">-</span>eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token function">min</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> Lt l<span class="token punctuation">{</span>a<span class="token punctuation">,</span> b <span class="token operator">-</span> a<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> l<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 两线段间距离（必须用浮点数）</span>
    T <span class="token function">dis</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> St <span class="token operator">&amp;</span>s<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">is_inter</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function">dis</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dis</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 计算线段的中垂线</span>
    Lt <span class="token function">midperp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        Pt mid <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 线段中点</span>
        Pt vec <span class="token operator">=</span> b <span class="token operator">-</span> a<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>mid<span class="token punctuation">,</span> Pt<span class="token punctuation">{</span><span class="token operator">-</span>vec<span class="token punctuation">.</span>y<span class="token punctuation">,</span> vec<span class="token punctuation">.</span>x<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 多边形</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Polygon</span> <span class="token punctuation">{</span>
    vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> p<span class="token punctuation">;</span> <span class="token comment">// 以逆时针顺序存储</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">ne</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> i<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> i <span class="token operator">==</span> p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">pre</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> i<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">// 回转数</span>
    <span class="token comment">// 返回值第一项表示点是否在多边形边上</span>
    <span class="token comment">// 对于狭义多边形，回转数为 0 表示点在多边形外，否则点在多边形内</span>
    pair<span class="token operator">&lt;</span><span class="token keyword keyword-bool">bool</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">winding</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-int">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> Pt u <span class="token operator">=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> v <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token function">ne</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">-</span> u<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> u<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> v<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>y <span class="token operator">-</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-continue">continue</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> Lt uv <span class="token operator">=</span> <span class="token punctuation">{</span>u<span class="token punctuation">,</span> v <span class="token operator">-</span> u<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> v<span class="token punctuation">.</span>y <span class="token operator">-</span> eps <span class="token operator">&amp;&amp;</span> uv<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-continue">continue</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>y <span class="token operator">&gt;</span> v<span class="token punctuation">.</span>y <span class="token operator">+</span> eps <span class="token operator">&amp;&amp;</span> uv<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-continue">continue</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> eps <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>y <span class="token operator">&gt;=</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> eps<span class="token punctuation">)</span> cnt<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>y <span class="token operator">&gt;=</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> eps <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> eps<span class="token punctuation">)</span> cnt<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">,</span> cnt<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 计算多边形内（不包括边上）的网格点数（必须用整数）</span>
    i64 <span class="token function">calc_pts_in_polygon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        i64 S <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> C <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            C <span class="token operator">+=</span> St<span class="token punctuation">{</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token function">ne</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">calc_pts_on_segment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 注意这里 S 和 C 其实可能 有 .5 的</span>
        <span class="token comment">// 只不过要有一起有，计算的时候就可以抵掉了。</span>
        S <span class="token operator">=</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token comment">// 多边形面积 = 多边形内网格点数 + 多边形边上网格点数 / 2 - 1</span>
        <span class="token comment">// 平行四边形格点仍然成立，三角形格点 等式右边 * 2</span>
        <span class="token comment">// S = I + C / 2 - 1</span>
        <span class="token keyword keyword-return">return</span> S <span class="token operator">-</span> C <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 多边形面积的两倍</span>
    <span class="token comment">// 可用于判断点的存储顺序是顺时针或逆时针</span>
    T <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        T sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> sum <span class="token operator">+=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> p<span class="token punctuation">[</span><span class="token function">ne</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 多边形的周长</span>
    T <span class="token function">circ</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        T sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> sum <span class="token operator">+=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token function">ne</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 凸多边形</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Convex</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">Polygon</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// 闵可夫斯基和</span>
    Convex <span class="token keyword keyword-operator">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Convex <span class="token operator">&amp;</span>c<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token operator">&amp;</span>p <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span>p<span class="token punctuation">;</span>
        vector<span class="token operator">&lt;</span>St<span class="token operator">&gt;</span> <span class="token function">e1</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">e2</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">edge</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> res<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> cmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> St <span class="token operator">&amp;</span>u<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> St <span class="token operator">&amp;</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token function">Argcmp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>b <span class="token operator">-</span> u<span class="token punctuation">.</span>a<span class="token punctuation">,</span> v<span class="token punctuation">.</span>b <span class="token operator">-</span> v<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> e1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">ne</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> c<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> e2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>c<span class="token punctuation">.</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>p<span class="token punctuation">[</span>c<span class="token punctuation">.</span><span class="token function">ne</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">rotate</span><span class="token punctuation">(</span>e1<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">min_element</span><span class="token punctuation">(</span>e1<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e1<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">,</span> e1<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">rotate</span><span class="token punctuation">(</span>e2<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">min_element</span><span class="token punctuation">(</span>e2<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e2<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">,</span> e2<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">merge</span><span class="token punctuation">(</span>e1<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e1<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e2<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e2<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> edge<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> check <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>res<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>u<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> back1 <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> back2 <span class="token operator">=</span> <span class="token operator">*</span><span class="token function">prev</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>back1 <span class="token operator">-</span> back2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>u <span class="token operator">-</span> back1<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>back1 <span class="token operator">-</span> back2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>u <span class="token operator">-</span> back1<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token operator">-</span>eps<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-auto">auto</span> u <span class="token operator">=</span> e1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>a <span class="token operator">+</span> e2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>a<span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token operator">&amp;</span>v <span class="token operator">:</span> edge<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
            u <span class="token operator">=</span> u <span class="token operator">+</span> v<span class="token punctuation">.</span>b <span class="token operator">-</span> v<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>res<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 旋转卡壳</span>
    <span class="token comment">// 例：凸多边形的直径的平方</span>
    T <span class="token function">rotcaliper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token operator">&amp;</span>p <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span>p<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">dis2</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> area <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>u<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>v<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>w<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>w <span class="token operator">-</span> u<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>w <span class="token operator">-</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        T ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> nxti <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">ne</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ans <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">{</span>ans<span class="token punctuation">,</span> p<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">dis2</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">dis2</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>nxti<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token function">area</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">ne</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>nxti<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token function">area</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>nxti<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                j <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">ne</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ans <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">{</span>ans<span class="token punctuation">,</span> p<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">dis2</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">dis2</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>nxti<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> ans<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 判断点是否在凸多边形内</span>
    <span class="token comment">// 复杂度 O(logn)</span>
    <span class="token comment">// -1 点在多边形边上 | 0 点在多边形外 | 1 点在多边形内</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">is_in</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token operator">&amp;</span>p <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span>p<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> a <span class="token operator">==</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> St<span class="token punctuation">{</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">is_on</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>a <span class="token operator">-</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>a <span class="token operator">-</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> cmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>u<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>u <span class="token operator">-</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>v <span class="token operator">-</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token function">lower_bound</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> cmp<span class="token punctuation">)</span> <span class="token operator">-</span> p<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> St<span class="token punctuation">{</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">is_on</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> St<span class="token punctuation">{</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">is_on</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>St<span class="token punctuation">{</span>p<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">is_on</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>a <span class="token operator">-</span> p<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 求点在凸多边形上的两侧的点，逆时针给出下标</span>
    <span class="token comment">// 必须保证 is_in(a) == -1</span>
    pair<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">around_points</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token operator">&amp;</span>p <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span>p<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>St<span class="token punctuation">{</span>p<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">is_on</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>St<span class="token punctuation">{</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">is_on</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> cmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>u<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>u <span class="token operator">-</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>v <span class="token operator">-</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token function">lower_bound</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> cmp<span class="token punctuation">)</span> <span class="token operator">-</span> p<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>St<span class="token punctuation">{</span>p<span class="token punctuation">[</span><span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">pre</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">is_on</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token function">pre</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ne</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">pre</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 凸多边形关于某一方向的极点</span>
    <span class="token comment">// 复杂度 O(logn)</span>
    <span class="token comment">// 参考资料：https://codeforces.com/blog/entry/48868</span>
    <span class="token comment">// 凸包点数 &gt;= 3</span>
    <span class="token keyword keyword-template">template</span> <span class="token operator">&lt;</span><span class="token keyword keyword-typename">typename</span> <span class="token class-name">F</span><span class="token operator">&gt;</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">extreme</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> F <span class="token operator">&amp;</span>dir<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token operator">&amp;</span>p <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span>p<span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> check <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token function">dir</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">ne</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> dir0 <span class="token operator">=</span> <span class="token function">dir</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> check0 <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>check0 <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> cmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> vi <span class="token operator">=</span> <span class="token operator">&amp;</span>v <span class="token operator">-</span> p<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>vi <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> checkv <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span>vi<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> t <span class="token operator">=</span> dir0<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>v <span class="token operator">-</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>vi <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> checkv <span class="token operator">==</span> check0 <span class="token operator">&amp;&amp;</span> t <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> checkv <span class="token operator">^</span> <span class="token punctuation">(</span>checkv <span class="token operator">==</span> check0 <span class="token operator">&amp;&amp;</span> t <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">partition_point</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span> <span class="token operator">-</span> p<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 过凸多边形外一点求凸多边形的切线，逆时针返回切点下标</span>
    <span class="token comment">// 复杂度 O(logn)</span>
    <span class="token comment">// 必须保证 点不在多边形内</span>
    <span class="token comment">// 凸多边形上返回两侧的点</span>
    <span class="token comment">// 凸包点数 &gt;= 3</span>
    pair<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">tangent</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">is_in</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token function">around_points</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token function">extreme</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>u<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> u <span class="token operator">-</span> a<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token function">extreme</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>u<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> a <span class="token operator">-</span> u<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>i<span class="token punctuation">,</span> j<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 求平行于给定直线的凸多边形的切线，返回切点下标</span>
    <span class="token comment">// 复杂度 O(logn)</span>
    <span class="token comment">// 凸包点数 &gt;= 3</span>
    pair<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">tangent</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Lt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token function">extreme</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> a<span class="token punctuation">.</span>v<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token function">extreme</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">-</span>a<span class="token punctuation">.</span>v<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>i<span class="token punctuation">,</span> j<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 最小矩形覆盖 O(n)，返回面积和矩形端点（必须用浮点数）</span>
    <span class="token comment">// 矩形端点按逆时针给出。</span>
    pair<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;&gt;</span> <span class="token function">min_rectangle_cover</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token operator">&amp;</span>p <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span>p<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> dot <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> u<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> v<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> w<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> cross <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> u<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> v<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> w<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>w<span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-int">int</span> u <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        T mu <span class="token operator">=</span> INF<span class="token punctuation">,</span> md <span class="token operator">=</span> <span class="token operator">-</span>INF<span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>mu <span class="token operator">&gt;=</span> <span class="token function">dot</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mu <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                u <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>md <span class="token operator">&lt;=</span> <span class="token function">dot</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                md <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                d <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        T ans <span class="token operator">=</span> INF<span class="token punctuation">;</span>
        vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> <span class="token function">rec</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> l <span class="token operator">&lt;</span> p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> l<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> nxtl <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">ne</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> nxtl<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token function">cross</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> nxtl<span class="token punctuation">,</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">ne</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> r <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">ne</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> nxtl<span class="token punctuation">,</span> u<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token function">dot</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> nxtl<span class="token punctuation">,</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">ne</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> u <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">ne</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> nxtl<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token function">dot</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> nxtl<span class="token punctuation">,</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">ne</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> d <span class="token operator">=</span> <span class="token keyword keyword-this">this</span><span class="token operator">-&gt;</span><span class="token function">ne</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Lt mid <span class="token operator">=</span> St<span class="token punctuation">{</span>p<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>nxtl<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">midperp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Lt L <span class="token operator">=</span> <span class="token punctuation">{</span>p<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>nxtl<span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            Lt R <span class="token operator">=</span> <span class="token punctuation">{</span>p<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span>nxtl<span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            T res <span class="token operator">=</span> L<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>mid<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> mid<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>ans <span class="token operator">&gt;</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ans <span class="token operator">=</span> res<span class="token punctuation">;</span>
                rec<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">.</span><span class="token function">pedal</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                rec<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">.</span><span class="token function">pedal</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                rec<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> R<span class="token punctuation">.</span><span class="token function">pedal</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>d<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                rec<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> R<span class="token punctuation">.</span><span class="token function">pedal</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>ans<span class="token punctuation">,</span> rec<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 圆 用浮点数</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>
    Pt c<span class="token punctuation">;</span>
    T r<span class="token punctuation">;</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Circle <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> c <span class="token operator">==</span> a<span class="token punctuation">.</span>c <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>r <span class="token operator">-</span> a<span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    T <span class="token function">circ</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token number">2</span> <span class="token operator">*</span> PI <span class="token operator">*</span> r<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 周长</span>
    T <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> PI <span class="token operator">*</span> r <span class="token operator">*</span> r<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 面积</span>
    <span class="token comment">// 点与圆的关系</span>
    <span class="token comment">// -1 圆上 | 0 圆外 | 1 圆内</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">is_in</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>p<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> T d <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">abs</span><span class="token punctuation">(</span>d <span class="token operator">-</span> r<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> d <span class="token operator">&lt;</span> r <span class="token operator">-</span> eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 直线与圆关系</span>
    <span class="token comment">// 0 相离 | 1 相切 | 2 相交</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">relation</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Lt <span class="token operator">&amp;</span>l<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> T d <span class="token operator">=</span> l<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>d <span class="token operator">&gt;</span> r <span class="token operator">+</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>d <span class="token operator">-</span> r<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 圆与圆关系</span>
    <span class="token comment">// -1 相同 | 0 相离 | 1 外切 | 2 相交 | 3 内切 | 4 内含</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">relation</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Circle <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">==</span> a<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> T d <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>d <span class="token operator">&gt;</span> r <span class="token operator">+</span> a<span class="token punctuation">.</span>r <span class="token operator">+</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>d <span class="token operator">-</span> r <span class="token operator">-</span> a<span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>d <span class="token operator">-</span> <span class="token function">abs</span><span class="token punctuation">(</span>r <span class="token operator">-</span> a<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>d <span class="token operator">&lt;</span> <span class="token function">abs</span><span class="token punctuation">(</span>r <span class="token operator">-</span> a<span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token operator">-</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 直线与圆的交点</span>
    vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> <span class="token function">inter</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Lt <span class="token operator">&amp;</span>l<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> T d <span class="token operator">=</span> l<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> Pt p <span class="token operator">=</span> l<span class="token punctuation">.</span><span class="token function">pedal</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> t <span class="token operator">=</span> <span class="token function">relation</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span><span class="token punctuation">{</span>p<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> T k <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>r <span class="token operator">*</span> r <span class="token operator">-</span> d <span class="token operator">*</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span><span class="token punctuation">{</span>p <span class="token operator">-</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>v <span class="token operator">/</span> l<span class="token punctuation">.</span>v<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> k<span class="token punctuation">,</span> p <span class="token operator">+</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span>v <span class="token operator">/</span> l<span class="token punctuation">.</span>v<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> k<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 圆与圆交点</span>
    vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> <span class="token function">inter</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Circle <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> T d <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> t <span class="token operator">=</span> <span class="token function">relation</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> t <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> t <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Pt e <span class="token operator">=</span> a<span class="token punctuation">.</span>c <span class="token operator">-</span> c<span class="token punctuation">;</span>
        e <span class="token operator">=</span> e <span class="token operator">/</span> e<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> r<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> t <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>r <span class="token operator">*</span> r <span class="token operator">+</span> d <span class="token operator">*</span> d <span class="token operator">-</span> a<span class="token punctuation">.</span>r <span class="token operator">*</span> a<span class="token punctuation">.</span>r <span class="token operator">&gt;=</span> <span class="token operator">-</span>eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span><span class="token punctuation">{</span>c <span class="token operator">+</span> e<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span><span class="token punctuation">{</span>c <span class="token operator">-</span> e<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-const">const</span> T costh <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">*</span> r <span class="token operator">+</span> d <span class="token operator">*</span> d <span class="token operator">-</span> a<span class="token punctuation">.</span>r <span class="token operator">*</span> a<span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> r <span class="token operator">*</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span> sinth <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> costh <span class="token operator">*</span> costh<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span><span class="token punctuation">{</span>c <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">rot</span><span class="token punctuation">(</span>costh<span class="token punctuation">,</span> <span class="token operator">-</span>sinth<span class="token punctuation">)</span><span class="token punctuation">,</span> c <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">rot</span><span class="token punctuation">(</span>costh<span class="token punctuation">,</span> sinth<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 圆与圆交面积</span>
    T <span class="token function">inter_area</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Circle <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> T d <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> t <span class="token operator">=</span> <span class="token function">relation</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> T costh1 <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">*</span> r <span class="token operator">+</span> d <span class="token operator">*</span> d <span class="token operator">-</span> a<span class="token punctuation">.</span>r <span class="token operator">*</span> a<span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> r <span class="token operator">*</span> d<span class="token punctuation">)</span><span class="token punctuation">,</span> costh2 <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>r <span class="token operator">*</span> a<span class="token punctuation">.</span>r <span class="token operator">+</span> d <span class="token operator">*</span> d <span class="token operator">-</span> r <span class="token operator">*</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> a<span class="token punctuation">.</span>r <span class="token operator">*</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> T sinth1 <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> costh1 <span class="token operator">*</span> costh1<span class="token punctuation">)</span><span class="token punctuation">,</span> sinth2 <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> costh2 <span class="token operator">*</span> costh2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> T th1 <span class="token operator">=</span> <span class="token function">acos</span><span class="token punctuation">(</span>costh1<span class="token punctuation">)</span><span class="token punctuation">,</span> th2 <span class="token operator">=</span> <span class="token function">acos</span><span class="token punctuation">(</span>costh2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> r <span class="token operator">*</span> r <span class="token operator">*</span> <span class="token punctuation">(</span>th1 <span class="token operator">-</span> costh1 <span class="token operator">*</span> sinth1<span class="token punctuation">)</span> <span class="token operator">+</span> a<span class="token punctuation">.</span>r <span class="token operator">*</span> a<span class="token punctuation">.</span>r <span class="token operator">*</span> <span class="token punctuation">(</span>th2 <span class="token operator">-</span> costh2 <span class="token operator">*</span> sinth2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 过圆外一点圆的切线</span>
    vector<span class="token operator">&lt;</span>Lt<span class="token operator">&gt;</span> <span class="token function">tangent</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> t <span class="token operator">=</span> <span class="token function">is_in</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>Lt<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> Pt v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token punctuation">(</span>a <span class="token operator">-</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> vector<span class="token operator">&lt;</span>Lt<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>a<span class="token punctuation">,</span> v<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Pt e <span class="token operator">=</span> a <span class="token operator">-</span> c<span class="token punctuation">;</span>
        e <span class="token operator">=</span> e <span class="token operator">/</span> e<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> r<span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> T costh <span class="token operator">=</span> r <span class="token operator">/</span> c<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> sinth <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> costh <span class="token operator">*</span> costh<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> Pt t1 <span class="token operator">=</span> c <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">rot</span><span class="token punctuation">(</span>costh<span class="token punctuation">,</span> <span class="token operator">-</span>sinth<span class="token punctuation">)</span><span class="token punctuation">,</span> t2 <span class="token operator">=</span> c <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">rot</span><span class="token punctuation">(</span>costh<span class="token punctuation">,</span> sinth<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> vector<span class="token operator">&lt;</span>Lt<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>a<span class="token punctuation">,</span> t1 <span class="token operator">-</span> a<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token punctuation">,</span> t2 <span class="token operator">-</span> a<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 两圆的公切线</span>
    vector<span class="token operator">&lt;</span>Lt<span class="token operator">&gt;</span> <span class="token function">tangent</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Circle <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> t <span class="token operator">=</span> <span class="token function">relation</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        vector<span class="token operator">&lt;</span>Lt<span class="token operator">&gt;</span> lines<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> t <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> lines<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> t <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> Pt p <span class="token operator">=</span> <span class="token function">inter</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>c <span class="token operator">-</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>c <span class="token operator">-</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">}</span><span class="token punctuation">;</span>
            lines<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>p<span class="token punctuation">,</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-const">const</span> T d <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> Pt e <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>c <span class="token operator">-</span> c<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>c <span class="token operator">-</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> T costh <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">-</span> a<span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token operator">/</span> d<span class="token punctuation">,</span> sinth <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> costh <span class="token operator">*</span> costh<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> Pt d1 <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">rot</span><span class="token punctuation">(</span>costh<span class="token punctuation">,</span> <span class="token operator">-</span>sinth<span class="token punctuation">)</span><span class="token punctuation">,</span> d2 <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">rot</span><span class="token punctuation">(</span>costh<span class="token punctuation">,</span> sinth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> Pt u1 <span class="token operator">=</span> c <span class="token operator">+</span> d1 <span class="token operator">*</span> r<span class="token punctuation">,</span> u2 <span class="token operator">=</span> c <span class="token operator">+</span> d2 <span class="token operator">*</span> r<span class="token punctuation">,</span> v1 <span class="token operator">=</span> a<span class="token punctuation">.</span>c <span class="token operator">+</span> d1 <span class="token operator">*</span> a<span class="token punctuation">.</span>r<span class="token punctuation">,</span> v2 <span class="token operator">=</span> a<span class="token punctuation">.</span>c <span class="token operator">+</span> d2 <span class="token operator">*</span> a<span class="token punctuation">.</span>r<span class="token punctuation">;</span>
            lines<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>u1<span class="token punctuation">,</span> v1 <span class="token operator">-</span> u1<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lines<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>u2<span class="token punctuation">,</span> v2 <span class="token operator">-</span> u2<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> T costh <span class="token operator">=</span> <span class="token punctuation">(</span>r <span class="token operator">+</span> a<span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token operator">/</span> d<span class="token punctuation">,</span> sinth <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> costh <span class="token operator">*</span> costh<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> Pt d1 <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">rot</span><span class="token punctuation">(</span>costh<span class="token punctuation">,</span> <span class="token operator">-</span>sinth<span class="token punctuation">)</span><span class="token punctuation">,</span> d2 <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">rot</span><span class="token punctuation">(</span>costh<span class="token punctuation">,</span> sinth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> Pt u1 <span class="token operator">=</span> c <span class="token operator">+</span> d1 <span class="token operator">*</span> r<span class="token punctuation">,</span> u2 <span class="token operator">=</span> c <span class="token operator">+</span> d2 <span class="token operator">*</span> r<span class="token punctuation">,</span> v1 <span class="token operator">=</span> a<span class="token punctuation">.</span>c <span class="token operator">-</span> d1 <span class="token operator">*</span> a<span class="token punctuation">.</span>r<span class="token punctuation">,</span> v2 <span class="token operator">=</span> a<span class="token punctuation">.</span>c <span class="token operator">-</span> d2 <span class="token operator">*</span> a<span class="token punctuation">.</span>r<span class="token punctuation">;</span>
            lines<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>u1<span class="token punctuation">,</span> v1 <span class="token operator">-</span> u1<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lines<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>u2<span class="token punctuation">,</span> v2 <span class="token operator">-</span> u2<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> lines<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 圆的反演</span>
    <span class="token comment">// auto result = circle.inverse(line);</span>
    <span class="token comment">// if (std::holds_alternative&lt;Circle&gt;(result))</span>
    <span class="token comment">// Circle c = std::get&lt;Circle&gt;(result);</span>
    std<span class="token double-colon punctuation">::</span>variant<span class="token operator">&lt;</span>Circle<span class="token punctuation">,</span> Lt<span class="token operator">&gt;</span> <span class="token function">inverse</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Lt <span class="token operator">&amp;</span>l<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>l<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> l<span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> Pt v <span class="token operator">=</span> l<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> Pt<span class="token punctuation">{</span>l<span class="token punctuation">.</span>v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token operator">-</span>l<span class="token punctuation">.</span>v<span class="token punctuation">.</span>x<span class="token punctuation">}</span> <span class="token operator">:</span> Pt<span class="token punctuation">{</span><span class="token operator">-</span>l<span class="token punctuation">.</span>v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> l<span class="token punctuation">.</span>v<span class="token punctuation">.</span>x<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> T d <span class="token operator">=</span> r <span class="token operator">*</span> r <span class="token operator">/</span> l<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> Pt p <span class="token operator">=</span> c <span class="token operator">+</span> v <span class="token operator">/</span> v<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> d<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> Circle<span class="token punctuation">{</span><span class="token punctuation">(</span>c <span class="token operator">+</span> p<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> d <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    std<span class="token double-colon punctuation">::</span>variant<span class="token operator">&lt;</span>Circle<span class="token punctuation">,</span> Lt<span class="token operator">&gt;</span> <span class="token function">inverse</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Circle <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> Pt v <span class="token operator">=</span> a<span class="token punctuation">.</span>c <span class="token operator">-</span> c<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">is_in</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> T d <span class="token operator">=</span> r <span class="token operator">*</span> r <span class="token operator">/</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>r <span class="token operator">+</span> a<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> Pt p <span class="token operator">=</span> c <span class="token operator">+</span> v <span class="token operator">/</span> v<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> d<span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> Lt<span class="token punctuation">{</span>p<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span>v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v<span class="token punctuation">.</span>x<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> a<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> Circle<span class="token punctuation">{</span>c<span class="token punctuation">,</span> r <span class="token operator">*</span> r <span class="token operator">/</span> a<span class="token punctuation">.</span>r<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> T d1 <span class="token operator">=</span> r <span class="token operator">*</span> r <span class="token operator">/</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">-</span> a<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span> d2 <span class="token operator">=</span> r <span class="token operator">*</span> r <span class="token operator">/</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">+</span> a<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> Pt p <span class="token operator">=</span> c <span class="token operator">+</span> v <span class="token operator">/</span> v<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> d1<span class="token punctuation">,</span> q <span class="token operator">=</span> c <span class="token operator">+</span> v <span class="token operator">/</span> v<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> d2<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> Circle<span class="token punctuation">{</span><span class="token punctuation">(</span>p <span class="token operator">+</span> q<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 点集的凸包</span>
<span class="token comment">// Andrew 算法，复杂度 O(nlogn)</span>
Convex <span class="token function">convexhull</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> st<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> Convex<span class="token punctuation">{</span>p<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">sort</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> check <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>st<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>u<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> back1 <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> back2 <span class="token operator">=</span> <span class="token operator">*</span><span class="token function">prev</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>back1 <span class="token operator">-</span> back2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>u <span class="token operator">-</span> back1<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>u <span class="token operator">:</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>st<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span>st<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">)</span> st<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        st<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-int">int</span> k <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">reverse</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>u <span class="token operator">:</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>st<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> k <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span>st<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">)</span> st<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        st<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    st<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> Convex<span class="token punctuation">{</span>st<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 最小圆覆盖 | 期望 O(n) | 必须用浮点数</span>
Circle <span class="token function">min_circle_cover</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mt19937_64 <span class="token function">rng</span><span class="token punctuation">(</span>chrono<span class="token double-colon punctuation">::</span>steady_clock<span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">time_since_epoch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 两点确定一个圆</span>
    <span class="token keyword keyword-auto">auto</span> get2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Circle <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 三点确定一个圆</span>
    <span class="token keyword keyword-auto">auto</span> get3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>b<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>c<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Circle <span class="token punctuation">{</span>
        Lt u <span class="token operator">=</span> St<span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">midperp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v <span class="token operator">=</span> St<span class="token punctuation">{</span>a<span class="token punctuation">,</span> c<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">midperp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Pt p <span class="token operator">=</span> u<span class="token punctuation">.</span><span class="token function">inter</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>p<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">shuffle</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rng<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Circle C<span class="token punctuation">{</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> a<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>C<span class="token punctuation">.</span>r <span class="token operator">&lt;</span> C<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            C <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>C<span class="token punctuation">.</span>r <span class="token operator">&lt;</span> C<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    C <span class="token operator">=</span> <span class="token function">get2</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> j<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>C<span class="token punctuation">.</span>r <span class="token operator">&lt;</span> C<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            C <span class="token operator">=</span> <span class="token function">get3</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> C<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 半平面交</span>
<span class="token comment">// 排序增量法，复杂度 O(nlogn)</span>
<span class="token comment">// 输入与返回值都是用直线表示的半平面集合</span>
vector<span class="token operator">&lt;</span>Lt<span class="token operator">&gt;</span> <span class="token function">halfinter</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Lt<span class="token operator">&gt;</span> l<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> T lim <span class="token operator">=</span> <span class="token number">1e9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 必须用浮点数，return &lt;= 则会去掉冗余线</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> check <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Lt <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Lt <span class="token operator">&amp;</span>b<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Lt <span class="token operator">&amp;</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> a<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">inter</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 无精度误差的方法，但注意取值范围会扩大到三次方</span>
    <span class="token comment">// const auto check = [](const Lt &amp;a, const Lt &amp;b, const Lt &amp;c) {</span>
    <span class="token comment">//     const Pt p = a.v * (b.v ^ c.v), q = b.p * (b.v ^ c.v) + b.v * (c.v ^ (b.p - c.p)) - a.p * (b.v ^ c.v);</span>
    <span class="token comment">//     return p.toleft(q) &lt; 0;</span>
    <span class="token comment">// };</span>
    l<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token operator">-</span>lim<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    l<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>lim<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    l<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">{</span>lim<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    l<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> lim<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sort</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> l<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    deque<span class="token operator">&lt;</span>Lt<span class="token operator">&gt;</span> q<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> l<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> l<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>v <span class="token operator">*</span> l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>v <span class="token operator">&gt;</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-continue">continue</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span>q<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> q<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> q<span class="token punctuation">.</span><span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>q<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> q<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>v<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>Lt<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        q<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>l<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span>q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span>q<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> q<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> q<span class="token punctuation">.</span><span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token generic-function"><span class="token function">vector</span><span class="token generic class-name"><span class="token operator">&lt;</span>Lt<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> q<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 平面最近点对</span>
<span class="token comment">// 扫描线，复杂度 O(nlogn)</span>
<span class="token comment">// 返回最近点对距离平方</span>
T <span class="token function">closest_pair</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> pts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sort</span><span class="token punctuation">(</span>pts<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pts<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> cmpy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>y <span class="token operator">-</span> b<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> a<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>x <span class="token operator">-</span> eps<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> a<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>y <span class="token operator">-</span> eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    multiset<span class="token operator">&lt;</span>Pt<span class="token punctuation">,</span> <span class="token keyword keyword-decltype">decltype</span><span class="token punctuation">(</span>cmpy<span class="token punctuation">)</span><span class="token operator">&gt;</span> s<span class="token punctuation">{</span>cmpy<span class="token punctuation">}</span><span class="token punctuation">;</span>
    T ans <span class="token operator">=</span> INF<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pts<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> T sqans <span class="token operator">=</span> <span class="token function">sqrtl</span><span class="token punctuation">(</span>ans<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;</span> i <span class="token operator">&amp;&amp;</span> pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> pts<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">&gt;=</span> sqans<span class="token punctuation">)</span> s<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>l<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-auto">auto</span> it <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">lower_bound</span><span class="token punctuation">(</span>Pt<span class="token punctuation">{</span><span class="token operator">-</span>INF<span class="token punctuation">,</span> pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> sqans<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> s<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> it<span class="token operator">-&gt;</span>y <span class="token operator">-</span> pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> sqans<span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ans <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>ans<span class="token punctuation">,</span> pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">dis2</span><span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        s<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> ans<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 点集形成的最小最大三角形</span>
<span class="token comment">// 极角序扫描线，复杂度 O(n^2logn)</span>
<span class="token comment">// 最大三角形问题可以使用凸包与旋转卡壳做到 O(n^2)</span>
pair<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&gt;</span> <span class="token function">minmax_triangle</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>vec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span> evt<span class="token punctuation">;</span>
    evt<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> vec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    T maxans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> minans <span class="token operator">=</span> INF<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> vec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> j<span class="token punctuation">)</span> <span class="token keyword keyword-continue">continue</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>vec<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> vec<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                minans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span>
                evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>i<span class="token punctuation">,</span> j<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">sort</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> evt<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> pair<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span>u<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> pair<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> Pt du <span class="token operator">=</span> vec<span class="token punctuation">[</span>u<span class="token punctuation">.</span>second<span class="token punctuation">]</span> <span class="token operator">-</span> vec<span class="token punctuation">[</span>u<span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">,</span> dv <span class="token operator">=</span> vec<span class="token punctuation">[</span>v<span class="token punctuation">.</span>second<span class="token punctuation">]</span> <span class="token operator">-</span> vec<span class="token punctuation">[</span>v<span class="token punctuation">.</span>first<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">Argcmp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>du<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token operator">-</span>du<span class="token punctuation">.</span>x<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>dv<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token operator">-</span>dv<span class="token punctuation">.</span>x<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">vx</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pos</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> vx<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token function">sort</span><span class="token punctuation">(</span>vx<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vx<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> x<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> vec<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">&lt;</span> vec<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vx<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> pos<span class="token punctuation">[</span>vx<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-auto">auto</span> <span class="token punctuation">[</span>u<span class="token punctuation">,</span> v<span class="token punctuation">]</span> <span class="token operator">:</span> evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> pos<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> j <span class="token operator">=</span> pos<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> l <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> Pt vecu <span class="token operator">=</span> vec<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">,</span> vecv <span class="token operator">=</span> vec<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>l <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> minans <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>minans<span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">(</span>vec<span class="token punctuation">[</span>vx<span class="token punctuation">[</span>l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> vecu<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>vec<span class="token punctuation">[</span>vx<span class="token punctuation">[</span>l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> vecv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>r <span class="token operator">&lt;</span> vx<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> minans <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>minans<span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">(</span>vec<span class="token punctuation">[</span>vx<span class="token punctuation">[</span>r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> vecu<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>vec<span class="token punctuation">[</span>vx<span class="token punctuation">[</span>r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> vecv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        maxans <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">{</span>maxans<span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">(</span>vec<span class="token punctuation">[</span>vx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> vecu<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>vec<span class="token punctuation">[</span>vx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> vecv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">(</span>vec<span class="token punctuation">[</span>vx<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-</span> vecu<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>vec<span class="token punctuation">[</span>vx<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-</span> vecv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> j<span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>vx<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vx<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pos<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">=</span> j<span class="token punctuation">,</span> pos<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>minans<span class="token punctuation">,</span> maxans<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 判断多条线段是否有交点</span>
<span class="token comment">// 扫描线，复杂度 O(nlogn)</span>
<span class="token keyword keyword-bool">bool</span> <span class="token function">segs_inter</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> vector<span class="token operator">&lt;</span>St<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>segs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>segs<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-using">using</span> seq_t <span class="token operator">=</span> tuple<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> St<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// x坐标 出入点 线段</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> seqcmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> seq_t <span class="token operator">&amp;</span>u<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> seq_t <span class="token operator">&amp;</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token punctuation">[</span>u0<span class="token punctuation">,</span> u1<span class="token punctuation">,</span> u2<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>u0 <span class="token operator">-</span> v0<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>u1<span class="token punctuation">,</span> u2<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> u0 <span class="token operator">&lt;</span> v0 <span class="token operator">-</span> eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>seq_t<span class="token operator">&gt;</span> seq<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-auto">auto</span> seg <span class="token operator">:</span> segs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>seg<span class="token punctuation">.</span>a<span class="token punctuation">.</span>x <span class="token operator">&gt;</span> seg<span class="token punctuation">.</span>b<span class="token punctuation">.</span>x <span class="token operator">+</span> eps<span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>seg<span class="token punctuation">.</span>a<span class="token punctuation">,</span> seg<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        seq<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>seg<span class="token punctuation">.</span>a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> seg<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        seq<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>seg<span class="token punctuation">.</span>b<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> seg<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">sort</span><span class="token punctuation">(</span>seq<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> seq<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> seqcmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    T x_now<span class="token punctuation">;</span>
    <span class="token keyword keyword-auto">auto</span> cmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> St <span class="token operator">&amp;</span>u<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> St <span class="token operator">&amp;</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>a<span class="token punctuation">.</span>x <span class="token operator">-</span> u<span class="token punctuation">.</span>b<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">||</span> <span class="token function">abs</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>a<span class="token punctuation">.</span>x <span class="token operator">-</span> v<span class="token punctuation">.</span>b<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> u<span class="token punctuation">.</span>a<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> v<span class="token punctuation">.</span>a<span class="token punctuation">.</span>y <span class="token operator">-</span> eps<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x_now <span class="token operator">-</span> u<span class="token punctuation">.</span>a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>b<span class="token punctuation">.</span>y <span class="token operator">-</span> u<span class="token punctuation">.</span>a<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> u<span class="token punctuation">.</span>a<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>b<span class="token punctuation">.</span>x <span class="token operator">-</span> u<span class="token punctuation">.</span>a<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>b<span class="token punctuation">.</span>x <span class="token operator">-</span> v<span class="token punctuation">.</span>a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x_now <span class="token operator">-</span> v<span class="token punctuation">.</span>a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>b<span class="token punctuation">.</span>y <span class="token operator">-</span> v<span class="token punctuation">.</span>a<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> v<span class="token punctuation">.</span>a<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>b<span class="token punctuation">.</span>x <span class="token operator">-</span> v<span class="token punctuation">.</span>a<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>b<span class="token punctuation">.</span>x <span class="token operator">-</span> u<span class="token punctuation">.</span>a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">-</span> eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    multiset<span class="token operator">&lt;</span>St<span class="token punctuation">,</span> <span class="token keyword keyword-decltype">decltype</span><span class="token punctuation">(</span>cmp<span class="token punctuation">)</span><span class="token operator">&gt;</span> s<span class="token punctuation">{</span>cmp<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> o<span class="token punctuation">,</span> seg<span class="token punctuation">]</span> <span class="token operator">:</span> seq<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x_now <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> it <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">lower_bound</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> s<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> seg<span class="token punctuation">.</span><span class="token function">is_inter</span><span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> s<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> seg<span class="token punctuation">.</span><span class="token function">is_inter</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">prev</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            s<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token operator">!=</span> s<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> it <span class="token operator">!=</span> s<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">prev</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_inter</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">next</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            s<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 圆与多边形面积交</span>
T <span class="token function">area_inter</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Circle <span class="token operator">&amp;</span>circ<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Polygon <span class="token operator">&amp;</span>poly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> cal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Circle <span class="token operator">&amp;</span>circ<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>b <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0.0L</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> ina <span class="token operator">=</span> circ<span class="token punctuation">.</span><span class="token function">is_in</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> inb <span class="token operator">=</span> circ<span class="token punctuation">.</span><span class="token function">is_in</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> Lt ab <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">,</span> b <span class="token operator">-</span> a<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>ina <span class="token operator">&amp;&amp;</span> inb<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>ina <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>inb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> t <span class="token operator">=</span> circ<span class="token punctuation">.</span><span class="token function">inter</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> Pt p <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> T ans <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> T th <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ang</span><span class="token punctuation">(</span>b <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> T d <span class="token operator">=</span> circ<span class="token punctuation">.</span>r <span class="token operator">*</span> circ<span class="token punctuation">.</span>r <span class="token operator">*</span> th <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>b <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> ans <span class="token operator">+</span> d<span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> ans <span class="token operator">-</span> d<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ina <span class="token operator">&amp;&amp;</span> inb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> Pt p <span class="token operator">=</span> circ<span class="token punctuation">.</span><span class="token function">inter</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> T ans <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> T th <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ang</span><span class="token punctuation">(</span>p <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> T d <span class="token operator">=</span> circ<span class="token punctuation">.</span>r <span class="token operator">*</span> circ<span class="token punctuation">.</span>r <span class="token operator">*</span> th <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>b <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> ans <span class="token operator">+</span> d<span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> ans <span class="token operator">-</span> d<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> p <span class="token operator">=</span> circ<span class="token punctuation">.</span><span class="token function">inter</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> St<span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">dis</span><span class="token punctuation">(</span>circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> circ<span class="token punctuation">.</span>r <span class="token operator">+</span> eps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> T ans <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> T th1 <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ang</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> th2 <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ang</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> T d1 <span class="token operator">=</span> circ<span class="token punctuation">.</span>r <span class="token operator">*</span> circ<span class="token punctuation">.</span>r <span class="token operator">*</span> th1 <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> d2 <span class="token operator">=</span> circ<span class="token punctuation">.</span>r <span class="token operator">*</span> circ<span class="token punctuation">.</span>r <span class="token operator">*</span> th2 <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>b <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> ans <span class="token operator">+</span> d1 <span class="token operator">+</span> d2<span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> ans <span class="token operator">-</span> d1 <span class="token operator">-</span> d2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-const">const</span> T th <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ang</span><span class="token punctuation">(</span>b <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>b <span class="token operator">-</span> circ<span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> circ<span class="token punctuation">.</span>r <span class="token operator">*</span> circ<span class="token punctuation">.</span>r <span class="token operator">*</span> th <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token operator">-</span>circ<span class="token punctuation">.</span>r <span class="token operator">*</span> circ<span class="token punctuation">.</span>r <span class="token operator">*</span> th <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    T ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> poly<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> Pt a <span class="token operator">=</span> poly<span class="token punctuation">.</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> poly<span class="token punctuation">.</span>p<span class="token punctuation">[</span>poly<span class="token punctuation">.</span><span class="token function">ne</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        ans <span class="token operator">+=</span> <span class="token function">cal</span><span class="token punctuation">(</span>circ<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> ans<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 多边形面积并</span>
<span class="token comment">// 轮廓积分，复杂度 O(n^2logn)，n为边数</span>
<span class="token comment">// ans[i] 表示被至少覆盖了 i+1 次的区域的面积</span>
vector<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token function">area_union</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> vector<span class="token operator">&lt;</span>Polygon<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>polys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> siz <span class="token operator">=</span> polys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span>Pt<span class="token punctuation">,</span> Pt<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">segs</span><span class="token punctuation">(</span>siz<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> check <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>u<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> St <span class="token operator">&amp;</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span>u <span class="token operator">&lt;</span> e<span class="token punctuation">.</span>a <span class="token operator">&amp;&amp;</span> u <span class="token operator">&lt;</span> e<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>u <span class="token operator">&gt;</span> e<span class="token punctuation">.</span>a <span class="token operator">&amp;&amp;</span> u <span class="token operator">&gt;</span> e<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-auto">auto</span> cut_edge <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> St <span class="token operator">&amp;</span>e<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> Lt le<span class="token punctuation">{</span>e<span class="token punctuation">.</span>a<span class="token punctuation">,</span> e<span class="token punctuation">.</span>b <span class="token operator">-</span> e<span class="token punctuation">.</span>a<span class="token punctuation">}</span><span class="token punctuation">;</span>
        vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span>Pt<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span> evt<span class="token punctuation">;</span>
        evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>e<span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>e<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> polys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> j<span class="token punctuation">)</span> <span class="token keyword keyword-continue">continue</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token operator">&amp;</span>pj <span class="token operator">=</span> polys<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> pj<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-const">const</span> St s <span class="token operator">=</span> <span class="token punctuation">{</span>pj<span class="token punctuation">.</span>p<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> pj<span class="token punctuation">.</span>p<span class="token punctuation">[</span>pj<span class="token punctuation">.</span><span class="token function">ne</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>le<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> le<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>s<span class="token punctuation">.</span>a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>s<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">is_inter</span><span class="token punctuation">(</span>le<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword keyword-const">const</span> Lt ls<span class="token punctuation">{</span>s<span class="token punctuation">.</span>a<span class="token punctuation">,</span> s<span class="token punctuation">.</span>b <span class="token operator">-</span> s<span class="token punctuation">.</span>a<span class="token punctuation">}</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-const">const</span> Pt u <span class="token operator">=</span> le<span class="token punctuation">.</span><span class="token function">inter</span><span class="token punctuation">(</span>ls<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>le<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> le<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                        evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>u<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>le<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> le<span class="token punctuation">.</span><span class="token function">toleft</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                        evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>u<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">sort</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> evt<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>a <span class="token operator">&gt;</span> e<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token function">reverse</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> evt<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-int">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> evt<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sum <span class="token operator">+=</span> evt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> Pt u <span class="token operator">=</span> evt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> v <span class="token operator">=</span> evt<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>u <span class="token operator">==</span> v<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span> segs<span class="token punctuation">[</span>sum<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>u<span class="token punctuation">,</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> e<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> polys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token operator">&amp;</span>pi <span class="token operator">=</span> polys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> pi<span class="token punctuation">.</span>p<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-const">const</span> St ei <span class="token operator">=</span> <span class="token punctuation">{</span>pi<span class="token punctuation">.</span>p<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> pi<span class="token punctuation">.</span>p<span class="token punctuation">[</span>pi<span class="token punctuation">.</span><span class="token function">ne</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token function">cut_edge</span><span class="token punctuation">(</span>ei<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    vector<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token function">ans</span><span class="token punctuation">(</span>siz<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> siz<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        T sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">sort</span><span class="token punctuation">(</span>segs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> segs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-int">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> segs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> segs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> segs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                segs<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span>cnt<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>segs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span>
                cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> sum <span class="token operator">+=</span> segs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>first <span class="token operator">^</span> segs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        ans<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sum <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> ans<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 圆面积并</span>
<span class="token comment">// 轮廓积分，复杂度 O(n^2logn)</span>
<span class="token comment">// ans[i] 表示被至少覆盖了 i+1 次的区域的面积</span>
vector<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token function">area_union</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> vector<span class="token operator">&lt;</span>Circle<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>circs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> siz <span class="token operator">=</span> circs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-using">using</span> arc_t <span class="token operator">=</span> tuple<span class="token operator">&lt;</span>Pt<span class="token punctuation">,</span> T<span class="token punctuation">,</span> T<span class="token punctuation">,</span> T<span class="token operator">&gt;</span><span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>arc_t<span class="token operator">&gt;&gt;</span> <span class="token function">arcs</span><span class="token punctuation">(</span>siz<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> eq <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> arc_t <span class="token operator">&amp;</span>u<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> arc_t <span class="token operator">&amp;</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token punctuation">[</span>u1<span class="token punctuation">,</span> u2<span class="token punctuation">,</span> u3<span class="token punctuation">,</span> u4<span class="token punctuation">]</span> <span class="token operator">=</span> u<span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token punctuation">[</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v3<span class="token punctuation">,</span> v4<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> u1 <span class="token operator">==</span> v1 <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>u2 <span class="token operator">-</span> v2<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>u3 <span class="token operator">-</span> v3<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>u4 <span class="token operator">-</span> v4<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-auto">auto</span> cut_circ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Circle <span class="token operator">&amp;</span>ci<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token operator">&gt;&gt;</span> evt<span class="token punctuation">;</span>
        evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">-</span>PI<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>PI<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-int">int</span> init <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> circs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> j<span class="token punctuation">)</span> <span class="token keyword keyword-continue">continue</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> Circle <span class="token operator">&amp;</span>cj <span class="token operator">=</span> circs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>ci<span class="token punctuation">.</span>r <span class="token operator">&lt;</span> cj<span class="token punctuation">.</span>r <span class="token operator">-</span> eps <span class="token operator">&amp;&amp;</span> ci<span class="token punctuation">.</span><span class="token function">relation</span><span class="token punctuation">(</span>cj<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">)</span> init<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> inters <span class="token operator">=</span> ci<span class="token punctuation">.</span><span class="token function">inter</span><span class="token punctuation">(</span>cj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>inters<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token function">atan2l</span><span class="token punctuation">(</span><span class="token punctuation">(</span>inters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> ci<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token punctuation">(</span>inters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> ci<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>inters<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-const">const</span> Pt dl <span class="token operator">=</span> inters<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> ci<span class="token punctuation">.</span>c<span class="token punctuation">,</span> dr <span class="token operator">=</span> inters<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> ci<span class="token punctuation">.</span>c<span class="token punctuation">;</span>
                T argl <span class="token operator">=</span> <span class="token function">atan2l</span><span class="token punctuation">(</span>dl<span class="token punctuation">.</span>y<span class="token punctuation">,</span> dl<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> argr <span class="token operator">=</span> <span class="token function">atan2l</span><span class="token punctuation">(</span>dr<span class="token punctuation">.</span>y<span class="token punctuation">,</span> dr<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>argl <span class="token operator">+</span> PI<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> argl <span class="token operator">=</span> PI<span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>argr <span class="token operator">+</span> PI<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> argr <span class="token operator">=</span> PI<span class="token punctuation">;</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>argl <span class="token operator">&gt;</span> argr <span class="token operator">+</span> eps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>argl<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>PI<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">-</span>PI<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>argr<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                    evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>argl<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    evt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>argr<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">sort</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> evt<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-int">int</span> sum <span class="token operator">=</span> init<span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> evt<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sum <span class="token operator">+=</span> evt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>evt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first <span class="token operator">-</span> evt<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">)</span> <span class="token operator">&gt;</span> eps<span class="token punctuation">)</span> arcs<span class="token punctuation">[</span>sum<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{</span>ci<span class="token punctuation">.</span>c<span class="token punctuation">,</span> ci<span class="token punctuation">.</span>r<span class="token punctuation">,</span> evt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">,</span> evt<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>first<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>evt<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>first <span class="token operator">-</span> PI<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> oint <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> arc_t <span class="token operator">&amp;</span>arc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token punctuation">[</span>cc<span class="token punctuation">,</span> cr<span class="token punctuation">,</span> l<span class="token punctuation">,</span> r<span class="token punctuation">]</span> <span class="token operator">=</span> arc<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>r <span class="token operator">-</span> l <span class="token operator">-</span> PI <span class="token operator">-</span> PI<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">2.0L</span> <span class="token operator">*</span> PI <span class="token operator">*</span> cr <span class="token operator">*</span> cr<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> cr <span class="token operator">*</span> cr <span class="token operator">*</span> <span class="token punctuation">(</span>r <span class="token operator">-</span> l<span class="token punctuation">)</span> <span class="token operator">+</span> cc<span class="token punctuation">.</span>x <span class="token operator">*</span> cr <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">sinl</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">sinl</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> cc<span class="token punctuation">.</span>y <span class="token operator">*</span> cr <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">cosl</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">cosl</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> circs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> <span class="token operator">&amp;</span>ci <span class="token operator">=</span> circs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">cut_circ</span><span class="token punctuation">(</span>ci<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    vector<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token function">ans</span><span class="token punctuation">(</span>siz<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> siz<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        T sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">sort</span><span class="token punctuation">(</span>arcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> arcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-int">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> arcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>j <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">eq</span><span class="token punctuation">(</span>arcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> arcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                arcs<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">++</span>cnt<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>arcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span>
                cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> sum <span class="token operator">+=</span> <span class="token function">oint</span><span class="token punctuation">(</span>arcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        ans<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sum <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> ans<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="动态凸包">动态凸包 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// https://codeforces.com/problemset/problem/70/D</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span>
<span class="token keyword keyword-using">using</span> ld <span class="token operator">=</span> <span class="token keyword keyword-long">long</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> i64 <span class="token operator">=</span> <span class="token keyword keyword-long">long</span> <span class="token keyword keyword-long">long</span><span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// 有浮点数但是大部分都是 i64 时，可以选择用 pair&lt;ld, ld&gt; 替换必需内容</span>
<span class="token comment">// 然后删去强制浮点数的函数，改用手写 pair&lt;ld, ld&gt; 替代。</span>
<span class="token keyword keyword-using">using</span> T <span class="token operator">=</span> i64<span class="token punctuation">;</span> <span class="token comment">// 全局数据类型</span>

<span class="token keyword keyword-const">const</span> T eps <span class="token operator">=</span> <span class="token number">1e-12</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> T INF <span class="token operator">=</span> <span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> T PI <span class="token operator">=</span> <span class="token function">acosl</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">setp</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> cout <span class="token operator">&lt;&lt;</span> fixed <span class="token operator">&lt;&lt;</span> <span class="token function">setprecision</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span></span>

<span class="token comment">// 点与向量</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Pt</span> <span class="token punctuation">{</span>
    T x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>y <span class="token operator">-</span> a<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">==</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> y <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> eps<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token generic-function"><span class="token function">x</span> <span class="token generic class-name"><span class="token operator">&lt;</span> a<span class="token punctuation">.</span>x <span class="token operator">-</span> eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">&lt;</span> a <span class="token operator">||</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">==</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">+</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> a<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">-</span> a<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> T k<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>k <span class="token operator">*</span> x<span class="token punctuation">,</span> k <span class="token operator">*</span> y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> T k<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">/</span> k<span class="token punctuation">,</span> y <span class="token operator">/</span> k<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    T <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">*</span> a<span class="token punctuation">.</span>x <span class="token operator">+</span> y <span class="token operator">*</span> a<span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 点积</span>
    T <span class="token keyword keyword-operator">operator</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">*</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> y <span class="token operator">*</span> a<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 叉积，注意优先级</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">toleft</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span> <span class="token operator">^</span> a<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>t <span class="token operator">&gt;</span> eps<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;</span> <span class="token operator">-</span>eps<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token comment">// to-left 测试</span>
    T <span class="token function">len2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>               <span class="token comment">// 向量长度的平方</span>
    T <span class="token function">dis2</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 两点距离的平方</span>
    <span class="token comment">// 0:原点 | 1:x轴正 | 2:第一象限</span>
    <span class="token comment">// 3:y轴正 | 4:第二象限 | 5:x轴负</span>
    <span class="token comment">// 6:第三象限 | 7:y轴负 | 8:第四象限</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">quad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> y <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token number">3</span> <span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> y <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token number">8</span> <span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 极角排序</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Argcmp</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>b<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> qa <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">quad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> qb <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">quad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>qa <span class="token operator">!=</span> qb<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> qa <span class="token operator">&lt;</span> qb<span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> t <span class="token operator">=</span> a <span class="token operator">^</span> b<span class="token punctuation">;</span>
        <span class="token comment">// 不同长度的向量需要分开</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> a <span class="token operator">*</span> a <span class="token operator">&lt;</span> b <span class="token operator">*</span> b <span class="token operator">-</span> eps<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> t <span class="token operator">&gt;</span> eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 注意整数时需要全体坐标在外面 * 3，才能保证准确</span>
<span class="token comment">// 注意要把 Argcmp 的 区分长度注释解除</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">DynamicConvex</span> <span class="token punctuation">{</span>
    Pt o<span class="token punctuation">;</span>
    set<span class="token operator">&lt;</span>Pt<span class="token punctuation">,</span> Argcmp<span class="token operator">&gt;</span> ss<span class="token punctuation">;</span> <span class="token comment">// 注意 ss 中的点 已经 - o</span>
    <span class="token keyword keyword-using">using</span> iter <span class="token operator">=</span> set<span class="token operator">&lt;</span>Pt<span class="token punctuation">,</span> Argcmp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator<span class="token punctuation">;</span>
    <span class="token function">DynamicConvex</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>b<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        o <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
        ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>a <span class="token operator">-</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>b <span class="token operator">-</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>c <span class="token operator">-</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    iter <span class="token function">pre</span><span class="token punctuation">(</span>iter it<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> it <span class="token operator">==</span> ss<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token operator">--</span>ss<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">--</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    iter <span class="token function">nxt</span><span class="token punctuation">(</span>iter it<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token operator">==</span> ss<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> ss<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> it<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">// -1 点在多边形边上 | 0 点在多边形外 | 1 点在多边形内</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">is_in</span><span class="token punctuation">(</span>Pt x<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> x <span class="token operator">-</span> o<span class="token punctuation">;</span>
        <span class="token keyword keyword-auto">auto</span> it <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">lower_bound</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> ss<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">*</span>it <span class="token operator">^</span> x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">*</span> x <span class="token operator">&lt;=</span> <span class="token operator">*</span>it <span class="token operator">*</span> <span class="token operator">*</span>it<span class="token punctuation">;</span>
        iter l <span class="token operator">=</span> <span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>
        iter r <span class="token operator">=</span> <span class="token punctuation">(</span>it <span class="token operator">==</span> ss<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> ss<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> it<span class="token punctuation">;</span>
        T res <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>l <span class="token operator">-</span> x <span class="token operator">^</span> <span class="token operator">*</span>r <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> res <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 凸包中加入点</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>Pt x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">is_in</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> x <span class="token operator">-</span> o<span class="token punctuation">;</span>
        <span class="token keyword keyword-auto">auto</span> <span class="token punctuation">[</span>it<span class="token punctuation">,</span> _<span class="token punctuation">]</span> <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">*</span>it <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">nxt</span><span class="token punctuation">(</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">*</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> ss<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">pre</span><span class="token punctuation">(</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">*</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token operator">*</span>it <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> ss<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 判断加入了这个点后...</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token function">tryToInsert</span><span class="token punctuation">(</span>Pt x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 能否成功加入这个点</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">is_in</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> x <span class="token operator">-</span> o<span class="token punctuation">;</span>
        <span class="token keyword keyword-auto">auto</span> <span class="token punctuation">[</span>it<span class="token punctuation">,</span> _<span class="token punctuation">]</span> <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 是否会删除其他的点</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>it <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">nxt</span><span class="token punctuation">(</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">*</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">pre</span><span class="token punctuation">(</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">*</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token operator">*</span>it <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ss<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        ss<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 强制擦除点</span>
    <span class="token comment">// 注意如果 erase 导致凸包重心转移，需要重新创建新的凸包</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">erase</span><span class="token punctuation">(</span>Pt x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> x <span class="token operator">-</span> o<span class="token punctuation">;</span>
        ss<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ios<span class="token double-colon punctuation">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-int">int</span> n<span class="token punctuation">;</span>
    cin <span class="token operator">&gt;&gt;</span> n<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">op</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> <span class="token function">pts</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cin <span class="token operator">&gt;&gt;</span> op<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">&gt;&gt;</span> pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    DynamicConvex <span class="token function">D</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pts<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pts<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 添加</span>
            D<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span> <span class="token comment">// 查询</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>D<span class="token punctuation">.</span><span class="token function">is_in</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"YES\n"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"NO\n"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="动态凸包重构">动态凸包重构 </h2>
<p><strong>计算能构成凸包的连续区间数</strong></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// 2025 HDU 多校 10 1005</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span>
<span class="token keyword keyword-using">using</span> ld <span class="token operator">=</span> <span class="token keyword keyword-long">long</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> i64 <span class="token operator">=</span> <span class="token keyword keyword-long">long</span> <span class="token keyword keyword-long">long</span><span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// 有浮点数但是大部分都是 i64 时，可以选择用 pair&lt;ld, ld&gt; 替换必需内容</span>
<span class="token comment">// 然后删去强制浮点数的函数，改用手写 pair&lt;ld, ld&gt; 替代。</span>
<span class="token keyword keyword-using">using</span> T <span class="token operator">=</span> i64<span class="token punctuation">;</span> <span class="token comment">// 全局数据类型</span>

<span class="token keyword keyword-const">const</span> T eps <span class="token operator">=</span> <span class="token number">1e-12</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> T INF <span class="token operator">=</span> <span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> T PI <span class="token operator">=</span> <span class="token function">acosl</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">setp</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> cout <span class="token operator">&lt;&lt;</span> fixed <span class="token operator">&lt;&lt;</span> <span class="token function">setprecision</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span></span>

<span class="token comment">// 点与向量</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Pt</span> <span class="token punctuation">{</span>
    T x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>y <span class="token operator">-</span> a<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">==</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> y <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> eps<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token generic-function"><span class="token function">x</span> <span class="token generic class-name"><span class="token operator">&lt;</span> a<span class="token punctuation">.</span>x <span class="token operator">-</span> eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">&lt;</span> a <span class="token operator">||</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">==</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">+</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> a<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">-</span> a<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> T k<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>k <span class="token operator">*</span> x<span class="token punctuation">,</span> k <span class="token operator">*</span> y<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> T k<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">/</span> k<span class="token punctuation">,</span> y <span class="token operator">/</span> k<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    T <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">*</span> a<span class="token punctuation">.</span>x <span class="token operator">+</span> y <span class="token operator">*</span> a<span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 点积</span>
    T <span class="token keyword keyword-operator">operator</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">*</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> y <span class="token operator">*</span> a<span class="token punctuation">.</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 叉积，注意优先级</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">toleft</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span> <span class="token operator">^</span> a<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>t <span class="token operator">&gt;</span> eps<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;</span> <span class="token operator">-</span>eps<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token comment">// to-left 测试</span>
    T <span class="token function">len2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>               <span class="token comment">// 向量长度的平方</span>
    T <span class="token function">dis2</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 两点距离的平方</span>
    <span class="token comment">// 0:原点 | 1:x轴正 | 2:第一象限</span>
    <span class="token comment">// 3:y轴正 | 4:第二象限 | 5:x轴负</span>
    <span class="token comment">// 6:第三象限 | 7:y轴负 | 8:第四象限</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">quad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> y <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token number">3</span> <span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> y <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> eps <span class="token operator">?</span> <span class="token number">8</span> <span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 极角排序</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Argcmp</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>b<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> qa <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">quad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> qb <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">quad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>qa <span class="token operator">!=</span> qb<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> qa <span class="token operator">&lt;</span> qb<span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-auto">auto</span> t <span class="token operator">=</span> a <span class="token operator">^</span> b<span class="token punctuation">;</span>
        <span class="token comment">// 不同长度的向量需要分开</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> a <span class="token operator">*</span> a <span class="token operator">&lt;</span> b <span class="token operator">*</span> b <span class="token operator">-</span> eps<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> t <span class="token operator">&gt;</span> eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 注意整数时需要全体坐标在外面 * 3，才能保证准确</span>
<span class="token comment">// 注意要把 Argcmp 的 区分长度注释解除</span>
<span class="token keyword keyword-struct">struct</span> <span class="token class-name">DynamicConvex</span> <span class="token punctuation">{</span>
    Pt o<span class="token punctuation">;</span>
    set<span class="token operator">&lt;</span>Pt<span class="token punctuation">,</span> Argcmp<span class="token operator">&gt;</span> ss<span class="token punctuation">;</span>
    <span class="token keyword keyword-using">using</span> iter <span class="token operator">=</span> set<span class="token operator">&lt;</span>Pt<span class="token punctuation">,</span> Argcmp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator<span class="token punctuation">;</span>
    <span class="token function">DynamicConvex</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>b<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        o <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
        ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>a <span class="token operator">-</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>b <span class="token operator">-</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>c <span class="token operator">-</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    iter <span class="token function">pre</span><span class="token punctuation">(</span>iter it<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> it <span class="token operator">==</span> ss<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token operator">--</span>ss<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">--</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    iter <span class="token function">nxt</span><span class="token punctuation">(</span>iter it<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token operator">==</span> ss<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> ss<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> it<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">// -1 点在多边形边上 | 0 点在多边形外 | 1 点在多边形内</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">is_in</span><span class="token punctuation">(</span>Pt x<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> x <span class="token operator">-</span> o<span class="token punctuation">;</span>
        <span class="token keyword keyword-auto">auto</span> it <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">lower_bound</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> ss<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">*</span>it <span class="token operator">^</span> x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">*</span> x <span class="token operator">&lt;=</span> <span class="token operator">*</span>it <span class="token operator">*</span> <span class="token operator">*</span>it<span class="token punctuation">;</span>
        iter l <span class="token operator">=</span> <span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>
        iter r <span class="token operator">=</span> <span class="token punctuation">(</span>it <span class="token operator">==</span> ss<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> ss<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> it<span class="token punctuation">;</span>
        T res <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>l <span class="token operator">-</span> x <span class="token operator">^</span> <span class="token operator">*</span>r <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> res <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>Pt x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// if (is_in(x) == 1) return;</span>
        x <span class="token operator">=</span> x <span class="token operator">-</span> o<span class="token punctuation">;</span>
        <span class="token keyword keyword-auto">auto</span> <span class="token punctuation">[</span>it<span class="token punctuation">,</span> _<span class="token punctuation">]</span> <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">*</span>it <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">nxt</span><span class="token punctuation">(</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">*</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> ss<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">pre</span><span class="token punctuation">(</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">*</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token operator">*</span>it <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> ss<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token function">tryToInsert</span><span class="token punctuation">(</span>Pt x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">is_in</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> x <span class="token operator">-</span> o<span class="token punctuation">;</span>
        <span class="token keyword keyword-auto">auto</span> <span class="token punctuation">[</span>it<span class="token punctuation">,</span> _<span class="token punctuation">]</span> <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>it <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">nxt</span><span class="token punctuation">(</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">*</span><span class="token function">nxt</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">pre</span><span class="token punctuation">(</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">*</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token operator">*</span>it <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">pre</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ss<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        ss<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 注意如果 erase 导致凸包重心转移，需要重新创建新的凸包</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">erase</span><span class="token punctuation">(</span>Pt x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> x <span class="token operator">-</span> o<span class="token punctuation">;</span>
        ss<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> tt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-int">int</span> n<span class="token punctuation">;</span>
    cin <span class="token operator">&gt;&gt;</span> n<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span>Pt<span class="token operator">&gt;</span> <span class="token function">pts</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cin <span class="token operator">&gt;&gt;</span> pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">&gt;&gt;</span> pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 最左边不共线的点</span>
    vector<span class="token operator">&lt;</span><span class="token keyword keyword-int">int</span><span class="token operator">&gt;</span> <span class="token function">lf</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> fir <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> pts<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span> pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> pts<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> lf<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            lf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fir <span class="token operator">&amp;&amp;</span> lf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> fir <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token number">1LL</span> <span class="token operator">*</span> n <span class="token operator">*</span> <span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    DynamicConvex <span class="token function">D</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pts<span class="token punctuation">[</span>fir <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pts<span class="token punctuation">[</span>fir<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> fir<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        D<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    i64 ans <span class="token operator">=</span> <span class="token number">1LL</span> <span class="token operator">*</span> fir <span class="token operator">*</span> <span class="token punctuation">(</span>fir <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> mid <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> L <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> R <span class="token operator">=</span> fir <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> R <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> R<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>L <span class="token operator">&lt;</span> R <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>D<span class="token punctuation">.</span><span class="token function">tryToInsert</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>R<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            D<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>L<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            L<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>mid <span class="token operator">&lt;</span> L<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// rebuild</span>
                D <span class="token operator">=</span> <span class="token function">DynamicConvex</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>lf<span class="token punctuation">[</span>R<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pts<span class="token punctuation">[</span>R <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pts<span class="token punctuation">[</span>R<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                mid <span class="token operator">=</span> lf<span class="token punctuation">[</span>R<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> lf<span class="token punctuation">[</span>R<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> R <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    D<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword keyword-int">int</span> newL <span class="token operator">=</span> lf<span class="token punctuation">[</span>R<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> lf<span class="token punctuation">[</span>R<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> L <span class="token operator">&amp;&amp;</span> D<span class="token punctuation">.</span><span class="token function">tryToInsert</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    D<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    newL <span class="token operator">=</span> i<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                L <span class="token operator">=</span> newL<span class="token punctuation">;</span>
                <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        D<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>pts<span class="token punctuation">[</span>R<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// cout &lt;&lt; L &lt;&lt; ' ' &lt;&lt; R &lt;&lt; '\n';</span>
        ans <span class="token operator">+=</span> R <span class="token operator">-</span> L <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cout <span class="token operator">&lt;&lt;</span> ans <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ios<span class="token double-colon punctuation">::</span><span class="token function">sync_with_stdio</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cin<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cout<span class="token punctuation">.</span><span class="token function">tie</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> tt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    cin <span class="token operator">&gt;&gt;</span> tt<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> tt<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">solve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><h2 id="三维基础">三维基础 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span>
<span class="token keyword keyword-using">using</span> ld <span class="token operator">=</span> <span class="token keyword keyword-long">long</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> i64 <span class="token operator">=</span> <span class="token keyword keyword-long">long</span> <span class="token keyword keyword-long">long</span><span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-using">using</span> T <span class="token operator">=</span> ld<span class="token punctuation">;</span> <span class="token comment">// 全局数据类型</span>

<span class="token keyword keyword-const">const</span> T eps <span class="token operator">=</span> <span class="token number">1e-12</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> T INF <span class="token operator">=</span> <span class="token class-name">numeric_limits</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> T PI <span class="token operator">=</span> <span class="token function">acosl</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">setp</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> cout <span class="token operator">&lt;&lt;</span> fixed <span class="token operator">&lt;&lt;</span> <span class="token function">setprecision</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span></span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Pt</span> <span class="token punctuation">{</span>
    T x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>y <span class="token operator">-</span> a<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>z <span class="token operator">-</span> a<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">==</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps <span class="token operator">&amp;&amp;</span> <span class="token function">abs</span><span class="token punctuation">(</span>y <span class="token operator">-</span> a<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> z <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>z <span class="token operator">-</span> eps<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> y <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> eps<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">x</span> <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>x <span class="token operator">-</span> eps<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token keyword keyword-operator">operator</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">&lt;</span> a <span class="token operator">||</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">==</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">+</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">+</span> a<span class="token punctuation">.</span>z<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">-</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">-</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">-</span> a<span class="token punctuation">.</span>z<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span><span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y <span class="token operator">-</span> z<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> T k<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>k <span class="token operator">*</span> x<span class="token punctuation">,</span> k <span class="token operator">*</span> y<span class="token punctuation">,</span> k <span class="token operator">*</span> z<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> T k<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">/</span> k<span class="token punctuation">,</span> y <span class="token operator">/</span> k<span class="token punctuation">,</span> z <span class="token operator">/</span> k<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    T <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">*</span> a<span class="token punctuation">.</span>x <span class="token operator">+</span> y <span class="token operator">*</span> a<span class="token punctuation">.</span>y <span class="token operator">+</span> z <span class="token operator">*</span> a<span class="token punctuation">.</span>z<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">// 注意三维叉积是向量</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>y <span class="token operator">*</span> a<span class="token punctuation">.</span>z <span class="token operator">-</span> z <span class="token operator">*</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">*</span> a<span class="token punctuation">.</span>x <span class="token operator">-</span> x <span class="token operator">*</span> a<span class="token punctuation">.</span>z<span class="token punctuation">,</span> x <span class="token operator">*</span> a<span class="token punctuation">.</span>y <span class="token operator">-</span> y <span class="token operator">*</span> a<span class="token punctuation">.</span>x<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    T <span class="token function">len2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>               <span class="token comment">// 向量长度的平方</span>
    T <span class="token function">dis2</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 两点距离的平方</span>
    <span class="token comment">// 必须用浮点数</span>
    T <span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token function">sqrtl</span><span class="token punctuation">(</span><span class="token function">len2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>                                                              <span class="token comment">// 向量长度</span>
    T <span class="token function">dis</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token function">sqrtl</span><span class="token punctuation">(</span><span class="token function">dis2</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>                                                  <span class="token comment">// 两点距离</span>
    T <span class="token function">ang</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token function">acosl</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.0L</span><span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token number">1.0L</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span> <span class="token operator">*</span> a<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> a<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 向量夹角</span>
    <span class="token comment">// 自身绕 向量v 逆时针旋转</span>
    Pt <span class="token function">rot</span><span class="token punctuation">(</span>Pt v<span class="token punctuation">,</span> <span class="token keyword keyword-const">const</span> T a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>
        v <span class="token operator">=</span> v <span class="token operator">/</span> v<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// 单位化轴</span>
        Pt p1 <span class="token operator">=</span> v <span class="token operator">*</span> <span class="token punctuation">(</span>v <span class="token operator">*</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 平行分量</span>
        Pt p2 <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span> <span class="token operator">-</span> p1<span class="token punctuation">;</span>      <span class="token comment">// 垂直分量 1</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> eps<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token operator">*</span><span class="token keyword keyword-this">this</span><span class="token punctuation">;</span>
        Pt p3 <span class="token operator">=</span> v <span class="token operator">^</span> p2<span class="token punctuation">;</span>                  <span class="token comment">// 垂直分量 2</span>
        p3 <span class="token operator">=</span> p3 <span class="token operator">*</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> p3<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调整成 p2 长度</span>
        <span class="token keyword keyword-return">return</span> p1 <span class="token operator">+</span> p2 <span class="token operator">*</span> <span class="token function">cosl</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> p3 <span class="token operator">*</span> <span class="token function">sinl</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Plane</span> <span class="token punctuation">{</span>
    <span class="token comment">// 点 法向量</span>
    Pt p<span class="token punctuation">,</span> n<span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> <span class="token function">tofront</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token comment">// 点在法向量方向</span>
        T t <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> p<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>t <span class="token operator">&gt;</span> eps<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;</span> <span class="token operator">-</span>eps<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 必须用浮点数</span>
    T <span class="token function">dis</span><span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> Pt <span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">-</span> p<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">)</span> <span class="token operator">/</span> n<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">// 求所有点距离平面的最大值：</span>
    <span class="token comment">// (所有点的法向量的点积的 max - min) / n.len()</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h2 id="三维凸包">三维凸包 </h2>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp cpp"><code><span class="token comment">// O(n²) 增量法求三维凸包</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bits/stdc++.h&gt;</span></span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> ld <span class="token operator">=</span> <span class="token keyword keyword-long">long</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> maxn <span class="token operator">=</span> <span class="token number">2e3</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> ld eps <span class="token operator">=</span> <span class="token number">1e-12</span><span class="token punctuation">;</span> <span class="token comment">// 精度要求高一点</span>

<span class="token keyword keyword-int">int</span> n<span class="token punctuation">,</span> m<span class="token punctuation">;</span>           <span class="token comment">// n是总点数，m是凸包中平面的数量</span>
<span class="token keyword keyword-bool">bool</span> g<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// g用来判断一条边被照到几次</span>

mt19937_64 <span class="token function">rng</span><span class="token punctuation">(</span>chrono<span class="token double-colon punctuation">::</span>steady_clock<span class="token double-colon punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">time_since_epoch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 用rand函数来生成一个非常小的随机数</span>
<span class="token keyword keyword-double">double</span> <span class="token function">rand_eps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 用rand生成一个-0.5到0.5之间的数，再乘eps，就得到了一个非常小的随机数</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token function">fmodl</span><span class="token punctuation">(</span><span class="token number">1.0L</span> <span class="token operator">*</span> <span class="token function">rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0L</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5L</span><span class="token punctuation">)</span> <span class="token operator">*</span> eps<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Pt</span> <span class="token punctuation">{</span>
    ld x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>
    <span class="token comment">// 微小扰动，给每个坐标都加一个极小的随机数</span>
    <span class="token keyword keyword-void">void</span> <span class="token function">shake</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> x <span class="token operator">+=</span> <span class="token function">rand_eps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">+=</span> <span class="token function">rand_eps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> z <span class="token operator">+=</span> <span class="token function">rand_eps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">-</span><span class="token punctuation">(</span>Pt t<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>x <span class="token operator">-</span> t<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">-</span> t<span class="token punctuation">.</span>y<span class="token punctuation">,</span> z <span class="token operator">-</span> t<span class="token punctuation">.</span>z<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Pt <span class="token keyword keyword-operator">operator</span><span class="token operator">^</span><span class="token punctuation">(</span>Pt t<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token punctuation">{</span>y <span class="token operator">*</span> t<span class="token punctuation">.</span>z <span class="token operator">-</span> t<span class="token punctuation">.</span>y <span class="token operator">*</span> z<span class="token punctuation">,</span> t<span class="token punctuation">.</span>x <span class="token operator">*</span> z <span class="token operator">-</span> x <span class="token operator">*</span> t<span class="token punctuation">.</span>z<span class="token punctuation">,</span> x <span class="token operator">*</span> t<span class="token punctuation">.</span>y <span class="token operator">-</span> y <span class="token operator">*</span> t<span class="token punctuation">.</span>x<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    ld <span class="token keyword keyword-operator">operator</span><span class="token operator">*</span><span class="token punctuation">(</span>Pt t<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> x <span class="token operator">*</span> t<span class="token punctuation">.</span>x <span class="token operator">+</span> y <span class="token operator">*</span> t<span class="token punctuation">.</span>y <span class="token operator">+</span> z <span class="token operator">*</span> t<span class="token punctuation">.</span>z<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    ld <span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword keyword-return">return</span> <span class="token function">sqrtl</span><span class="token punctuation">(</span>x <span class="token operator">*</span> x <span class="token operator">+</span> y <span class="token operator">*</span> y <span class="token operator">+</span> z <span class="token operator">*</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span> p<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// p来存所有点</span>

<span class="token keyword keyword-struct">struct</span> <span class="token class-name">Plane</span> <span class="token punctuation">{</span>  <span class="token comment">// 定义平面的结构体</span>
    <span class="token keyword keyword-int">int</span> v<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">// 三个顶点</span>
    Pt <span class="token function">norm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 求法向量</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-bool">bool</span> <span class="token function">above</span><span class="token punctuation">(</span>Pt t<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 判断一个点是否在平面上方</span>
        <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>t <span class="token operator">-</span> p<span class="token punctuation">[</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">norm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ld <span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 求三角形的面积</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">norm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> plane<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">,</span> tp<span class="token punctuation">[</span>maxn<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// plane存凸包上的平面，tp用来更新凸包，</span>
<span class="token comment">// 每次凸包上要留的平面和新加的平面都存进tp，</span>
<span class="token comment">// 要删的平面不存，最后将tp在复制给plane，就实现了凸包的更新</span>

<span class="token keyword keyword-void">void</span> <span class="token function">convex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    plane<span class="token punctuation">[</span>m<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>       <span class="token comment">// 初始化凸包，随便三个点存入，确定最开始的一个平面，这里取得是前三个点</span>
    plane<span class="token punctuation">[</span>m<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>       <span class="token comment">// 因为不知道第一个平面怎么样是逆时针，所以都存一遍，顺时针存的一会会被删掉</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 从第四个点开始循环每个点</span>
        <span class="token keyword keyword-int">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token comment">// 循环每个平面</span>
            <span class="token keyword keyword-bool">bool</span> fg <span class="token operator">=</span> plane<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">above</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 判断这个点是否在该平面上方</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fg<span class="token punctuation">)</span> tp<span class="token punctuation">[</span>cnt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> plane<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 如果是下方的话，说明照不到，存进tp数组</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">// 循环该平面的三条边</span>
                <span class="token comment">// ab边照不照得到情况赋值给g[a][b]</span>
                g<span class="token punctuation">[</span>plane<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>plane<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">[</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> fg<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 然后就循环每个平面的每条边</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-int">int</span> a <span class="token operator">=</span> plane<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> plane<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>v<span class="token punctuation">[</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">// 判断该边是否被照到了一次，即是否是交界线的边</span>
                <span class="token comment">// 若是，加新平面abi，ab一定是逆时针的，i在后面</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>g<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>g<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">)</span> tp<span class="token punctuation">[</span>cnt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> i<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        m <span class="token operator">=</span> cnt<span class="token punctuation">;</span> <span class="token comment">// 将tp再赋值给plane</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> plane<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tp<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cin <span class="token operator">&gt;&gt;</span> n<span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cin <span class="token operator">&gt;&gt;</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">&gt;&gt;</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&gt;&gt;</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>z<span class="token punctuation">;</span> <span class="token comment">// 输入n个点</span>
        p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">shake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// 微小扰动</span>
    <span class="token punctuation">}</span>
    <span class="token function">convex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// 求三维凸包</span>
    ld ans <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                 <span class="token comment">// 求面积和</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// 循环最终凸包上的m个平面</span>
        ans <span class="token operator">+=</span> plane<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将平面的面积加和</span>
    cout <span class="token operator">&lt;&lt;</span> fixed <span class="token operator">&lt;&lt;</span> <span class="token function">setprecision</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> ans <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
      
      
    
    
    
    
    
    
  
    </body></html>